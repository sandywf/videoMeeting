{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","width","mainCanvas","offsetWidth","height","offsetHeight","largen","cw","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","CustomEvent","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","isIE","isChrome","eventMap","click","down","move","up","wheel","fullScreen","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","noCache","noTab","super","noToolbar","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","tabLimit","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","ele","target","addEventListener","fn","use","attachEvent","removeEventListener","detachEvent","original","_target","running","slice","arguments","event","requestAnimationFrame","addEvent","addClass","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextElementSibling","nextSibling","attrName","attrValue","style","scrolls","createElement","yTpl","Scroll","activeType","moveCallback","parentNode","node","events","scrollObj","scrollBuilder","tplDiv","removeChild","firstChild","appendChild","container","toolbar","getElementsByClassName","scrollWidth","classList","remove","left","top","defineProperty","d","mousemoveHandler","obj","args","clientX","coverWidth","distance","startPoint","clientY","scroll","mouseupHandler","delEvent","redefineEvent","param","offsetLeft","scrollLeft","moveWidth","coverHeight","offsetTop","scrollTop","fire","resize","add","scrollHeight","moveHeight","eventName","splice","indexOf","forEach","create","uuid","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","key","hasOwnProperty","copy","item","index","count","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","page","getPage","_data_","pageNumber","getPageNumber","arr","saveData","_createImage","pop","content","splitPage","keys","sort","b","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","scale","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","font","renderImage","fileCanvas","img","tplImage","src","onload","imgWidth","imgHeight","resizePad","cWidth","cHeight","resizePadPixel","pWidth","pHeight","drawImage","pw","ph","sImgWidth","sImgHeight","dw","dh","cwhp","iwhp","delete","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderText","mouseIconCanvas","px","py","mouse","Tab","UL","tabMap","dataMap","activeObj","idList","saving","tabWrap","build","_params","that","_tabTpl","tabTpl","del","delTpl","innerHTML","_id","li","firstElementChild","canvasMap","getElementsByTagName","cancelBubble","preventDefault","stopPropagation","onTabRemove","resizeTab","tabName","onError","message","saveAsImage","it","setTimeout","pageMap","getData","localStorage","setItem","JSON","stringify","setProperty","noResize","dontOrigin","hide","css","getTab","tabId","cleanCache","removeItem","outData","_tab","Page","currentPage","show","pageEle","div","prePageBtn","pre","total","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","keyCode","which","start","__data","some","flag","removeClass","nextPageBtn","pageWrap","splitpageLayout","right","empower","onClear","WPad","setAttribute","waitList","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","_toolbar","_childToolbars","_tpl2","childToolbarStr","toolbarStr","__str__","parse","getItem","canvasWrap","toolbarWrap","bufferCanvas1","createSize","canvasWrapWidth","canvasWrapHeight","$2","_canvasWrapWidth","_canvasWrapHeight","detail","oldAvilWidth","oldAvilHeight","avilWidth","avilHeight","w","h","bufferCanvas2","bufferCanvas3","init","onScroll","fullScreenBtn","fullScreenInterface","cancelFullScreenInterface","pad","showFiles","files","newTab","isShow","_showFiles","setPage","pageObj","onShowFiles","result","fileInput","readAsDataURL","textInput","trim","shiftKey","span","srcElement","level","getAttribute","handPad","removeAttribute","downloadEle","imageDataArr","split","bStr","atob","tArr","Uint8ClampedArray","charCodeAt","href","url","download","timer","clearTimeout","padBox","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","returnValue","mouseX","mouseY","targetTouches","getBoundingClientRect","posX","posY","toLowerCase","moveX","moveY","_n","realData","renderAll","dataArr","renderMouse","console","error","enable","createImage","turnPage","number","removeTab","wPad","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tCustomEvent = window.CustomEvent,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\tisIE = /\\bMSIE\\b/i.test(navigator.userAgent),\r\n\t\tisChrome = /\\bchrome\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mouserun\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\",\r\n\t\t\tfullScreen: isIE?\"MSFullscreenChange\":(isChrome?\"webkitfullscreenchange\":(isFireFox?\"mozfullscreenchange\":\"fullscreenchange\")),\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tnoCache: false,\r\n\t\t\tnoTab: false,\r\n\t\t\tsuper: false,\r\n\t\t\tnoToolbar: false,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttabLimit: 20,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@ @NOTOOLBAR@ @NOTAB@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div class=\"split-page\">\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\tredefineEvent: function(original, current, _target, use) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttarget = _target || window,\r\n\t\t\t\trunning = false;\r\n\r\n\t\t\tvar fn = function() {\r\n\t\t\t\tif(running) return ;\r\n\t\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\t\trunning = true;\r\n\r\n\t\t\t\twindow.requestAnimationFrame(function() {\r\n\t\t\t\t\ttarget.dispatchEvent(new CustomEvent(current, {detail: e}));\r\n\t\t\t\t\trunning = false;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tself.addEvent(target, original, fn, use);\r\n\t\t\treturn fn;\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\ttplDiv = document.createElement(\"DIV\"),\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>',\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tmoveCallback = null,\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\t\t\tself.scrollObj = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\ttplDiv.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\t\t\t\tvar ele = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\tparentNode.appendChild(ele);\r\n\r\n\t\t\t\tself.scrollObj[type] = {\r\n\t\t\t\t\tcontainer: ele,\r\n\t\t\t\t\ttoolbar: ele.getElementsByClassName(\"scroll-toolbar\")[0]\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t\tself.scrollObj[type].left = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t\tself.scrollObj[type].top = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\tobj = self.scrollObj[activeType],\r\n\t\t\t\t\te = args[0] || window.event,\r\n\t\t\t\t\te = isMobile?e:(e.detail?e.detail:e);\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX, \r\n\t\t\t\t\t\tdata = {\r\n\t\t\t\t\t\t\ttype: \"x\", \r\n\t\t\t\t\t\t\tfrom: params.id,\r\n\t\t\t\t\t\t\tcoverWidth: obj.coverWidth,\r\n\t\t\t\t\t\t\tdistance: obj.left+(x-startPoint.x)\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY, \r\n\t\t\t\t\t\tdata = {\r\n\t\t\t\t\t\t\ttype: \"y\", \r\n\t\t\t\t\t\t\tfrom: params.id,\r\n\t\t\t\t\t\t\tcoverHeight: obj.coverHeight,\r\n\t\t\t\t\t\t\tdistance: obj.top+(y-startPoint.y)\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", moveCallback);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.scrollObj.x) {\r\n\t\t\t\tele.addEvent(self.scrollObj.x.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\t\t\tmoveCallback = ele.redefineEvent(\"mousemove\", \"mouserun\", document);\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mouserun\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.scrollObj.y) {\r\n\t\t\t\tele.addEvent(self.scrollObj.y.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\t\t\tmoveCallback = ele.redefineEvent(\"mousemove\", \"mouserun\", document);\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mouserun\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params,\r\n\t\t\t\t\tobj = this.scrollObj[param.type],\r\n\t\t\t\t\tcontainer = obj.container,\r\n\t\t\t\t\ttoolbar = obj.toolbar;\r\n\r\n\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\tparam.distance = param.distance * (obj.coverWidth/param.coverWidth);\r\n\t\t\t\t\tvar offsetLeft = Math.max(0, Math.min(obj.coverWidth, param.distance));\r\n\t\t\t\t\tparams.node.scrollLeft = offsetLeft;\r\n\t\t\t\t\ttoolbar.style.left = obj.moveWidth*(offsetLeft/obj.coverWidth) + \"px\";\r\n\t\t\t\t\tthis.scrollObj.x.left = offsetLeft;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparam.distance = param.distance * (obj.coverHeight/param.coverHeight);\r\n\t\t\t\t\tvar offsetTop = Math.max(0, Math.min(obj.coverHeight, param.distance));\r\n\t\t\t\t\tparams.node.scrollTop = offsetTop;\r\n\t\t\t\t\ttoolbar.style.top = obj.moveHeight*(offsetTop/obj.coverHeight) + \"px\";\r\n\t\t\t\t\tthis.scrollObj.y.top = offsetTop;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(void(0)==this.params.id || param.from==this.params.id) this.fire(\"scroll\", param);\r\n\t\t\t},\r\n\t\t\ttoOrigin: function(type) {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(!type) {\r\n\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.scrollObj.x) {\r\n\t\t\t\t\tvar obj = this.scrollObj.x,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoolbar.style.width = Math.max(obj.container.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverWidth = coverWidth;\r\n\t\t\t\t\tobj.moveWidth = obj.container.clientWidth - toolbar.offsetWidth;\r\n\r\n\t\t\t\t\tif(0===obj.moveWidth) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.scrollObj.y) {\r\n\t\t\t\t\tvar obj = this.scrollObj.y,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\ttoolbar.style.height = Math.max(obj.container.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverHeight = coverHeight;\r\n\t\t\t\t\tobj.moveHeight = obj.container.clientHeight - toolbar.offsetHeight;\r\n\r\n\t\t\t\t\tif(0===obj.moveHeight) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\treturn Date.now().toString();\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tif(!arg.hasOwnProperty(key)) continue;\r\n\t\t\t\t\t\t\tvar val = arg[key], type = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcontainer && firstArg.push(container);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tif(!firstArg.hasOwnProperty(key)) continue;\r\n\t\t\t\t\t\t\tvar val = firstArg[key], type = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(), page = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) _data_.pageNumber = page.getPageNumber();\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tif(!obj.hasOwnProperty(key)) continue;\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort(function(a, b) {\r\n\t\t\t\treturn a-b;\r\n\t\t\t});\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tcWidth = params.width,\r\n\t\t\t\tcHeight = params.height,\r\n\t\t\t\timg = self.tplImage,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.src = data[0];\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width, imgHeight = img.height;\r\n\r\n\t\t\t\tif(\"file\"===params.type && 0!=params.status && !isCreateImage) {\r\n\t\t\t\t\tcWidth = self.params.width;\r\n\t\t\t\t\tcHeight = self.params.height;\r\n\t\t\t\t\tself.tab.resizePad(cWidth, cHeight);\r\n\t\t\t\t\tself.tab.resizePadPixel(cWidth, cHeight);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(\"file\"===params.type) {\r\n\t\t\t\t\tvar imgScale = imgWidth/imgHeight,\r\n\t\t\t\t\t\tpWidth = imgWidth,\r\n\t\t\t\t\t\tpHeight = imgHeight;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(cHeight>cWidth/imgScale) {\r\n\t\t\t\t\t\tpHeight = (imgHeight + imgHeight*(cHeight/cWidth - imgHeight/imgWidth))>>0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcHeight = (cWidth/(imgWidth/imgHeight))>>0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.tab.resizePad(cWidth, cHeight);\r\n\t\t\t\t\tself.tab.resizePadPixel(pWidth, pHeight);\r\n\t\t\t\t\tctx.drawImage(img, (pWidth-imgWidth)/2, (pHeight-imgHeight)/2, imgWidth, imgHeight);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar pw = canvas.width,\r\n\t\t\t\t\t\tph = canvas.height,\r\n\t\t\t\t\t\twScale = pw/cWidth,\r\n\t\t\t\t\t\thScale = ph/cHeight,\r\n\t\t\t\t\t\tsImgWidth = imgWidth*wScale,\r\n\t\t\t\t\t\tsImgHeight = imgHeight*hScale,\r\n\t\t\t\t\t\tdw = pw - sImgWidth, \r\n\t\t\t\t\t\tdh = ph - sImgHeight;\r\n\r\n\t\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tctx.drawImage(img, x, y, sImgWidth, sImgHeight);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar cwhp = pw/ph, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (pw-ph*iwhp)/2, 0, ph*iwhp, ph);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ph-pw/iwhp)/2, pw, pw/iwhp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))) || 0,\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex))) || 0;\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(wScale, hScale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, _params) {\r\n\t\t\t\tif(!canvas) return ;\r\n\r\n\t\t\t\tif(idList.length>=this.params.tabLimit) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(this.params.onError) && this.params.onError({code: 0, message: \"白板页签已达上限\"});\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\ttype = _params.type,\r\n\t\t\t\t\t_data = _params.data,\r\n\t\t\t\t\tfrom = _params.from,\r\n\t\t\t\t\tdel = 0===_params.type?false:(that.params.super?true:from == that.params.id),\r\n\t\t\t\t\t_id = _params.id?_params.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _params.name?_params.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tfrom: from\r\n\t\t\t\t};\r\n\r\n\t\t\t\tself.resizeTab();\r\n\t\t\t\tif(_params.name) that.container[_id].tabName = _params.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tif(!pageMap.hasOwnProperty(key)) continue;\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.resizeTab = function() {\r\n\t\t\t\tvar totalWidth = tabWrap.clientWidth,\r\n\t\t\t\t\ttabCount = idList.length,\r\n\t\t\t\t\twidth = totalWidth/tabCount;\r\n\r\n\t\t\t\twidth = width>112?112:width;\r\n\t\t\t\ttabWrap.style.setProperty(\"--tab-width\", width-12 + \"px\");\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\t\t\t\tdelete pageMap[_id];\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\r\n\t\t\t\tif(activeObj.id==_id) {\r\n\t\t\t\t\t_id = idList[Math.max(index-1, 0)];\r\n\t\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.tab.resizeTab();\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id, noResize, dontOrigin) {\r\n\t\t\t\tif(!tabMap[_id]) return false;\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\r\n\t\t\t\tif(!noResize) {\r\n\t\t\t\t\tself.tab.resizePad();\r\n\t\t\t\t\tself.tab.resizePadPixel();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t!dontOrigin && self.scroll.toOrigin();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.name = self.container[_id].tabName || \"\";\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t!self.params.noCache && window.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"keypress\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = window.event || args[0];\r\n\r\n\t\t\tif(13===e.keyCode || 13===e.which) {\r\n\t\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\r\n\t\t\tif(_data.length>1) {\r\n\t\t\t\tpageWrap.appendChild(pageEle);\r\n\r\n\t\t\t\tswitch(that.params.splitpageLayout) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\tpageWrap.style.left = \"10px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\tpageWrap.style.left = (pageWrap.parentNode.clientWidth - pageWrap.offsetWidth)/2 + \"px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tpageWrap.style.right = \"10px\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.tab.getActive().page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.mainCanvas.offsetWidth,\r\n\t\t\t\t\theight: that.mainCanvas.offsetHeight,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId==that.tab.getActive().id && params.pageNumber==currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\t\t\t\tvoid(0)===params && \"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.tab.getActive().page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\t\tshow && this.show();\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar tplImage = new Image();\r\n\t\ttplImage.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\ttplImage: tplImage,\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\tactiveTab.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tif(!_data.hasOwnProperty(key)) continue;\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() == val.pageNumber) {\r\n\t\t\t\t\t\t\tactiveTab.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && activeTab.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, {\r\n\t\t\t\t\t\t\ttype: 1,\r\n\t\t\t\t\t\t\tdata: [realData],\r\n\t\t\t\t\t\t\tid: key,\r\n\t\t\t\t\t\t\tfrom: realData.from\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tif(!_data.hasOwnProperty(key)) continue;\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.getData = function(tabId) {\r\n\t\t\treturn that.container[tabId] || that.container;\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\treturn that.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id==activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)==id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\"))\r\n\t\t\t\t\t\t\t.replace(/@TOOLBARS@/g, toolbarStr)\r\n\t\t\t\t\t\t\t.replace(/@DISABLED@/g, params.disable?\"disabled\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTOOLBAR@/g, params.noToolbar?\"no-toolbar\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTAB@/g, params.noTab?\"no-tab\":\"\");\r\n\t\tvar _data = params.data || (!params.noCache?JSON.parse(window.localStorage.getItem(self.id+\"_pad\")):null);\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar canvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\t// bufferCanvas1的mousemove事件回调\r\n\t\tvar bc1MoveCallback = ele.redefineEvent(\"mousemove\", \"mouserun\", bufferCanvas1);\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*\\*\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tcanvasWrapWidth = +RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = +RegExp.$2;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*:\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/RegExp.$1*RegExp.$2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/RegExp.$2*RegExp.$1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)%\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth/100*RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight/100*RegExp.$1;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tcanvasWrapWidth = canvasWrap.clientWidth;\r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth>>0;\r\n\t\t\tparams.height = canvasWrapHeight>>0;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true!=scrollObj.disable && scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\tvar data = {\r\n\t\t\t\t\ttype: \"y\", \r\n\t\t\t\t\tfrom: params.id,\r\n\t\t\t\t\tcoverHeight: scrollObj.scrollObj.y.coverHeight,\r\n\t\t\t\t\tdistance: scrollObj.scrollObj.y.top+(\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/5\r\n\t\t\t\t};\r\n\r\n\t\t\t\tscrollObj.scroll(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.redefineEvent(\"resize\", \"sizeChange\", window);\r\n\r\n\t\tele.addEvent(window, \"sizeChange\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id, null, true);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\r\n\t\t\tself.tab.resizeTab();\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.style.width = bufferCanvas1.style.width = bufferCanvas2.style.width = bufferCanvas3.style.width = bufferCanvas4.style.width = width + \"px\";\r\n\t\t\tmainCanvas.style.height = bufferCanvas1.style.height = bufferCanvas2.style.height = bufferCanvas3.style.height = bufferCanvas4.style.height = height + \"px\";\r\n\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = 0;\r\n\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = 0;\r\n\r\n\t\t\tif(width<canvasWrap.clientWidth) {\r\n\t\t\t\tvar left = (canvasWrap.clientWidth - width)/2;\r\n\t\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = left + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tif(height<canvasWrap.clientHeight) {\r\n\t\t\t\tvar top = (canvasWrap.clientHeight - height)/2;\r\n\t\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = top + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tvar resizePadPixel = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.width = bufferCanvas1.width = bufferCanvas2.width = bufferCanvas3.width = bufferCanvas4.width = width;\r\n\t\t\tmainCanvas.height = bufferCanvas1.height = bufferCanvas2.height = bufferCanvas3.height = bufferCanvas4.height = height;\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tid: params.id\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tself.scroll = scrollObj;\r\n\r\n\t\tscrollObj.addEvent(\"scroll\", function(data) {\r\n\t\t\t\"[object Function]\"===toString.call(params.onScroll) && params.onScroll(data);\r\n\t\t});\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(self.tab, \"resizePadPixel\", {\r\n\t\t\tvalue: resizePadPixel\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tele.addEvent(wrap.getElementsByClassName(\"pad-wrap\")[0], eventMap[\"fullScreen\"], function() {\r\n\t\t\tisFullScreen = !isFullScreen;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t\tisFullScreen = flag;\r\n\t\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = self.tab.getActive().name || data.uuid,\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas,\r\n\t\t\t\tctx = createImageCanvas.getContext(\"2d\"),\r\n\t\t\t\tpadBox = self.params.wrap.getElementsByClassName(\"pad-wrap\")[0];\r\n\r\n\t\t\tctx.drawImage(self.fileCanvas, 0, 0);\r\n\t\t\tctx.drawImage(self.mainCanvas, 0, 0);\r\n\r\n\t\t\tvar\timage = createImageCanvas.toDataURL(),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8ClampedArray(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.className = \"export-image\";\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tpadBox.appendChild(downloadEle);\r\n\t\t\tdownloadEle.click();\r\n\r\n\t\t\tvar timer = setTimeout(function() {\r\n\t\t\t\ttimer && clearTimeout(timer);\r\n\t\t\t\tURL.revokeObjectURL(url);\r\n\t\t\t}, 300);\r\n\t\t\t\r\n\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\t\t\tpadBox.removeChild(downloadEle);\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\tif(!isNaN(w) && !isNaN(h)) {\r\n\t\t\t\tresizePad(w, h);\r\n\t\t\t\tresizePadPixel(w, h);\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id, true);\r\n\t\t\t} else {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t}\t\t\t\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\twidth: params.width,\r\n\t\t\t\t\theight: params.height,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id==from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, {\r\n\t\t\t\t\ttype: 1,\r\n\t\t\t\t\tid: tabId, \r\n\t\t\t\t\tname: tabName,\r\n\t\t\t\t\tfrom: from\r\n\t\t\t\t});\r\n\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom == self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(0==self.tab.getActive().id) {\r\n\t\t\t\t\tself.toolbarMap.image.renderBuffer.call(self, params.files);\r\n\t\t\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.pad.clear();\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\te = isMobile?e:(e.detail?e.detail:e);\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===scrollObj.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\r\n\t\t\t\t\tif(isMobile) {\r\n\t\t\t\t\t\tmoveX /= 10;\r\n\t\t\t\t\t\tmoveY /= 10;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.x.coverWidth>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({\r\n\t\t\t\t\t\t\ttype: \"x\", \r\n\t\t\t\t\t\t\tfrom: params.id,\r\n\t\t\t\t\t\t\tdistance: scrollObj.scrollObj.x.left+moveX,\r\n\t\t\t\t\t\t\tcoverWidth: scrollObj.scrollObj.x.coverWidth\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({\r\n\t\t\t\t\t\t\ttype: \"y\", \r\n\t\t\t\t\t\t\tfrom: params.id,\r\n\t\t\t\t\t\t\tdistance: scrollObj.scrollObj.y.top+moveY,\r\n\t\t\t\t\t\t\tcoverHeight: scrollObj.scrollObj.y.coverHeight\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, {type: 0});\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tObject.keys(_data).sort(function(a, b) {return a-b}).forEach(function(key) {\r\n\t\t\t\tvar val = _data[key];\r\n\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, {\r\n\t\t\t\t\ttype: val.type,\r\n\t\t\t\t\tdata: val.data,\r\n\t\t\t\t\tid: key, \r\n\t\t\t\t\tname: val.tabName,\r\n\t\t\t\t\tfrom: val.from\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\t_params.id = void(0)==_params.id?data.uuid:_params.id;\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + (data.x + self.mainCanvas.offsetLeft) + \"px; top: \" + (data.y + self.mainCanvas.offsetTop -self.textInput.offsetHeight/2 - 18) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}