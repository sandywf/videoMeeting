!function e(t,a,n){function i(s,o){if(!a[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[s]={exports:{}};t[s][0].call(d.exports,function(e){var a=t[s][1][e];return i(a||e)},d,d.exports,e,t,a,n)}return a[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,a){!function(){"use strict";var e={circular:0,quadrate:1},t=null,a=null;function n(e){this.name=e.name||"Eraser",this.interimBuffer=[],this.buffer=[]}n.prototype={constructor:n,active:function(){},mouseRender:function(a){var n=this;a={type:"eraser",data:[a.x,a.y,n.params.eraserSize],mode:e[n.current.name],from:n.params.id,width:n.mainCanvas.offsetWidth,height:n.mainCanvas.offsetHeight},t=a,n.mouseRender.call(n,a)},largen:function(){var e=this,a=e.params.eraserSize,n=e.mainCanvas.clientWidth,i=e.mainCanvas.clientHeight;a++,e.params.eraserSize=Math.min.apply(Math,[a,n,i]),t.data[2]=e.params.eraserSize,e.mouseRender.call(e,t)},lesser:function(){var e=this,a=e.params.eraserSize;a--,e.params.eraserSize=Math.max.apply(Math,[5,a]),t.data[2]=e.params.eraserSize,e.mouseRender.call(e,t)},bufferRender:function(t,n){if(t){var i=this,r={type:"eraser",data:[],status:1,origin:!0,mode:e[i.current.name],from:i.params.id,width:i.mainCanvas.offsetWidth,height:i.mainCanvas.offsetHeight};!n&&a?(t.ex=a.x,t.ey=a.y):(t.ex=t.x,t.ey=t.y),t.size=i.params.eraserSize,r.data.push(t),i.render(r),a=t}},render:function(){},destory:function(){this.current.mouseRender.call(this,{x:-1,y:-1})}};var i=window.vm||{};i.module=i.module||{},i.module.eraser=n,window.vm=i}()},{}],2:[function(e,t,a){!function(){"use strict";function e(e){this.name=e.name||"Ferula",this.buffer=[]}e.prototype={constructor:e,active:function(){},mouseRender:function(e){var t=this;e={type:"ferula",data:[e.x,e.y],from:t.params.id,width:t.mainCanvas.offsetWidth,height:t.mainCanvas.offsetHeight},e,t.mouseRender.call(t,e)},destory:function(){this.current.mouseRender.call(this,{x:-1,y:-1})}};var t=window.vm||{};t.module=t.module||{},t.module.ferula=e,window.vm=t}()},{}],3:[function(e,t,a){!function(){"use strict";function e(e){this.name=e.name||"Image",this.interimBuffer=[],this.buffer=[]}e.prototype={constructor:e,active:function(){},renderBuffer:function(e){var t=this;e={type:"image",data:[e],status:0,origin:!0,from:t.params.id,width:t.mainCanvas.offsetWidth,height:t.mainCanvas.offsetHeight};t.toolbarMap.image.interimBuffer.push(e)},render:function(e){if(e){var t=this,a=t.toolbarMap.image.interimBuffer.shift();if(a)do{a.status=1,a.data=[].concat.apply(a.data,e),t.toolbarMap.image.buffer.push(a),t.render(a),a=t.toolbarMap.image.interimBuffer.shift()}while(a)}},destory:function(){}};var t=window.vm||{};t.module=t.module||{},t.module.image=e,window.vm=t}()},{}],4:[function(e,t,a){!function(){"use strict";var e=window.vm||{},t=Object.prototype.toString,a=window.URL||window.webkitURL,n=window.CustomEvent,i={},r=0,s=[],o=/(\bmobile\b|\bandroid\b)/i.test(navigator.userAgent),l=/\bfirefox\b/i.test(navigator.userAgent),c=/\bMSIE\b/i.test(navigator.userAgent),d=/\bchrome\b/i.test(navigator.userAgent),u={click:o?"touchend":"click",down:o?"touchstart":"mousedown",move:o?"touchmove":"mouserun",up:o?"touchend":"mouseup",wheel:l?"DOMMouseScroll":"mousewheel",fullScreen:c?"MSFullscreenChange":d?"webkitfullscreenchange":l?"mozfullscreenchange":"fullscreenchange"},f={leftTop:"left-top",rightTop:"right-top",rightBottom:"right-bottom",leftBottom:"left-bottom"},h={data:null,noCache:!1,noTab:!1,super:!1,noToolbar:!1,layout:"leftTop",size:"100%",fontSize:16,vertical:!1,disable:!1,wrap:document.body,autoSaveTime:10,saveImgStep:5,color:"#000",background:"#fff",eraserSize:5,ferulaSize:5,tabLimit:20,toolbars:o?["pen","line","rectangle","round","text","image","eraser","export","clear"]:["ferula","pen","line","rectangle","round","text","image","eraser","export","clear","color"]},p={rectangle:["rectstroke","rect"],line:["line","arrow"],round:["circle","roundel","ellipesstroke","ellipes"],eraser:["circular","quadrate"]},m={ferula:"教鞭",circle:"空心圆",roundel:"实心圆",ellipesstroke:"空心椭圆",rectstroke:"空心矩形",pen:"画笔",circular:"圆形橡皮擦",quadrate:"方形橡皮擦",rect:"实心矩形",ellipes:"实心椭圆",text:"文本",line:"直线",arrow:"箭头",color:"颜色",export:"导出",scissors:"截图",clear:"清空",image:"图片"},v={ferula:"icon-teach-rod",circle:"icon-round-a",roundel:"icon-round-c",ellipesstroke:"icon-ellipse-b",rectstroke:"icon-rectangle-a",pen:"icon-pen",circular:"icon-xiangpica",quadrate:"icon-rubber",rect:"icon-rectangle-c",ellipes:"icon-ellipse-a",text:"icon-font",line:"icon-line",arrow:"icon-arrow",color:"icon-colour",export:"icon-keep",scissors:"icon-screenshot",clear:"icon-empty",image:"icon-pic"},g={0:"白板",1:"文档演示"},b='\t\t<div class="pad-wrap @LAYOUT@ @DISABLED@ @NOTOOLBAR@ @NOTAB@">\t\t\t<div class="toolbar-wrap">\t\t\t\t<ul class="toolbar-list">@TOOLBARS@</ul>\t\t\t</div>\t\t\t<div class="can-wrap-outer">\t\t\t\t<div class="can-wrap">\t\t\t\t\t<input type="text" class="text-input tool-input"/>\t\t\t\t\t<canvas class="main-can">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\t\t\t\t\t<canvas class="buffer-can-4"></canvas>\t\t\t\t\t<canvas class="buffer-can-3"></canvas>\t\t\t\t\t<canvas class="buffer-can-2"></canvas>\t\t\t\t\t<canvas class="buffer-can-1"></canvas>\t\t\t\t</div>\t\t\t\t<div class="split-page-wrap"></div>\t\t\t</div>\t\t\t<div class="pad-tab-wrap">\t\t\t\t<ul class="pad-tab-list"></ul>\t\t\t</div>\t\t\t<input type="file" accept="image/png, image/jpeg" class="file-input tool-input"/>\t\t\t<input type="color" class="color-input tool-input"/>\t\t</div>',w='<li class="toolbar-item" title="@TITLE@"><span class="item-icon iconfont @ICONCLASS@" item="@ITEM@" level="@LEVEL@"></span>@CHILDTOOLBARS@</li>',y='<ul class="child-toolbar-list">@CHILDTOOLBARITEM@</ul>',C='\t\t<div class="split-page">\t\t\t<a href="javascript:void(0);" class="pre-page-btn iconfont icon-zuofanye"></a>\t\t\t<a href="javascript:void(0);" class="next-page-btn iconfont icon-youfanye"></a>\t\t\t<span><input type="text" class="page-number-input"/>/@TOTAL@<a href="javascript:void(0);" class="go-page-btn">GO</a></span>\t\t</div>',x='<li class="toolbar-item full-screen-btn-wrap"><span class="item-icon full-screen-btn iconfont icon-enlarge" item="fullScreen"></span></li>';e.module=e.module||{};var E={addEvent:window.addEventListener?function(e,t,a,n){e.addEventListener(t,a,n||!1)}:function(e,t,a){e.attachEvent("on"+t,a)},delEvent:window.addEventListener?function(e,t,a,n){e.removeEventListener(t,a,n||!1)}:function(e,t,a){e.detachEvent("on"+t,a)},redefineEvent:function(e,t,a,i){var r=a||window,s=!1,o=function(){if(!s){var e=[].slice.call(arguments,0)[0]||window.event;s=!0,window.requestAnimationFrame(function(){r.dispatchEvent(new n(t,{detail:e})),s=!1})}};return this.addEvent(r,e,o,i),o},addClass:function(e,t){void 0!==e&&void 0!==t&&(new RegExp("\\b"+t+"\\b","g").test(e.className)||(e.className=e.className+" "+t))},removeClass:function(e,t){if(void 0!==e&&void 0!==t){var a=new RegExp("\\b"+t+"\\b","g");a.test(e.className)&&(e.className=e.className.replace(a,""))}},preNode:function(e){return e.previousElementSibling||e.previousSibling},nextNode:function(e){return e.nextElementSibling||e.nextSibling},css:function(e,t,a){e.style[t]=a||""}},T=function(){var e=[],a=document.createElement("DIV"),n='<div class="scroll-x-wrap pad-hide"><span class="scroll-x scroll-toolbar"></span></div>',i='<div class="scroll-y-wrap pad-hide"><span class="scroll-y scroll-toolbar"></span></div>';function r(e){if(!(this instanceof r))return new r(e);var t=this,s=!1,l="x",c={x:0,y:0},d=null,u=e.node.parentNode;t.params=e,t.events={},t.scrollObj={};var f=function(r){a.innerHTML="x"===r?n:i;var s=a.removeChild(a.firstChild);u.appendChild(s),t.scrollObj[r]={container:s,toolbar:s.getElementsByClassName("scroll-toolbar")[0]},"x"===r?(e.node.clientWidth<e.node.scrollWidth&&s.classList.remove("pad-hide"),t.scrollObj[r].left=0):(e.node.clientHeight<e.node.scrollHeight&&s.classList.remove("pad-hide"),t.scrollObj[r].top=0)};Object.defineProperty(this,"disable",{set:function(e){s=e},get:function(){return s}}),e.type?f(e.type):(f("x"),f("y"));var h=function(){var a=[].slice.call(arguments,0),n=t.scrollObj[l],i=a[0]||window.event;i=o?i:i.detail?i.detail:i;if("x"===l){var r=i.x||i.clientX,s={type:"x",from:e.id,coverWidth:n.coverWidth,distance:n.left+(r-c.x)};c.x=r}else{var d=i.y||i.clientY;s={type:"y",from:e.id,coverHeight:n.coverHeight,distance:n.top+(d-c.y)};c.y=d}t.scroll(s)},p=function(){E.delEvent(document,"mousemove",d),E.delEvent(document,"mouseup",p)};t.scrollObj.x&&E.addEvent(t.scrollObj.x.toolbar,"mousedown",function(){if(!s){var e=[].slice.call(arguments,0)[0]||window.event;d=E.redefineEvent("mousemove","mouserun",document),c.x=e.x||e.clientX,l="x",E.addEvent(document,"mouserun",h),E.addEvent(document,"mouseup",p)}}),t.scrollObj.y&&E.addEvent(t.scrollObj.y.toolbar,"mousedown",function(){if(!s){var e=[].slice.call(arguments,0)[0]||window.event;d=E.redefineEvent("mousemove","mouserun",document),c.y=e.y||e.clientY,l="y",E.addEvent(document,"mouserun",h),E.addEvent(document,"mouseup",p)}})}return r.prototype={constructor:r,scroll:function(e){var t=this.params,a=this.scrollObj[e.type],n=(a.container,a.toolbar);if("x"===e.type){e.distance=e.distance*(a.coverWidth/e.coverWidth);var i=Math.max(0,Math.min(a.coverWidth,e.distance));t.node.scrollLeft=i,n.style.left=a.moveWidth*(i/a.coverWidth)+"px",this.scrollObj.x.left=i}else{e.distance=e.distance*(a.coverHeight/e.coverHeight);var r=Math.max(0,Math.min(a.coverHeight,e.distance));t.node.scrollTop=r,n.style.top=a.moveHeight*(r/a.coverHeight)+"px",this.scrollObj.y.top=r}void 0!=this.params.id&&e.from!=this.params.id||this.fire("scroll",e)},toOrigin:function(e){var t=this.params;e?"x"===e?(this.scrollObj.x.toolbar.style.left=0,t.node.scrollLeft=0):(this.scrollObj.y.toolbar.style.top=0,t.node.scrollTop=0):(this.scrollObj.x.toolbar.style.left=0,this.scrollObj.y.toolbar.style.top=0,t.node.scrollLeft=0,t.node.scrollTop=0)},resize:function(){var e=this.params;if(this.scrollObj.x){var t=(n=this.scrollObj.x).toolbar,a=e.node.scrollWidth-e.node.clientWidth;t.style.width=Math.max(n.container.clientWidth-a/10,50)+"px",n.coverWidth=a,n.moveWidth=n.container.clientWidth-t.offsetWidth,0===n.moveWidth?n.container.classList.add("pad-hide"):n.container.classList.remove("pad-hide")}if(this.scrollObj.y){t=(n=this.scrollObj.y).toolbar;var n,i=e.node.scrollHeight-e.node.clientHeight;t.style.height=Math.max(n.container.clientHeight-i/10,50)+"px",n.coverHeight=i,n.moveHeight=n.container.clientHeight-t.offsetHeight,0===n.moveHeight?n.container.classList.add("pad-hide"):n.container.classList.remove("pad-hide")}},addEvent:function(e,t){var a=this.events;a[e]?a[e].push(t):a[e]=[t]},delEvent:function(e,a){var n=this.events;"[object Function]"===t.call(a)?n[e].splice(n[e].indexOf(a),1):delete n[e]},fire:function(){var e=[].slice.call(arguments,0),a=e.shift(),n=this.events;n[a]&&n[a].forEach(function(a){"[object Function]"===t.call(a)&&a.apply(Object.create(null),e)})}},{init:function(t){if(t.node){var a=new r(t);return e.push(a),a}},resize:function(){e.forEach(function(e){e.resize()})}}}(),O={get uuid(){return Date.now().toString()},scale:function(e){var t=e,a=t.type,n=null,i=null;switch(n&&i||(n=this.mainCanvas.width/t.width,i=this.mainCanvas.height/t.height),a){case"pen":t.data.x=t.data.x*n,t.data.y=t.data.y*i;break;case"text":t.data[0]=t.data[0]*n,t.data[1]=t.data[1]*n;break;case"image":case"file":break;case"eraser":t.data.x=t.data.x*n,t.data.y=t.data.y*i,t.data.size=t.data.size*n;break;default:t.data[0]&&(t.data[0]=isNaN(t.data[0])?t.data[0]:t.data[0]*n),t.data[1]&&(t.data[1]=isNaN(t.data[1])?t.data[1]:t.data[1]*n),t.data[2]&&(t.data[2]=isNaN(t.data[2])?t.data[2]:t.data[2]*n),t.data[3]&&(t.data[3]=isNaN(t.data[3])?t.data[3]:t.data[3]*n)}},copy:function(){var e=[].slice.call(arguments,0),a=e.shift();if(e.length)return"[object Object]"!=(s=t.call(a))&&"[object Array]"!=s?a:(e.forEach(function(e){var n=t.call(e);if("[object Object]"==n||"[object Array]"==n)if("[object Object]"===n){if("[object Array]"===o)var i={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r],o=t.call(s);i?i[r]="[object Object]"===o||"[object Array]"===o?O.copy(s):s:a[r]="[object Object]"===o||"[object Array]"===o?O.copy(s):s}i&&a.push(i)}else e.forEach(function(e,n){var i=t.call(e);"[object Object]"===o?a[n]="[object Object]"===i||"[object Array]"===i?O.copy(s):s:"[object Object]"===i||"[object Array]"===i?a.push(O.copy(s)):a.push(s)})}),a);if("[object Object]"!=(s=t.call(a))&&"[object Array]"!=s)return a;if("[object Object]"===s){var n={};for(var i in a)if(a.hasOwnProperty(i)){var r=a[i],s=t.call(r);n[i]="[object Object]"===s||"[object Array]"===s?O.copy(r):r}}else{n=[];a.forEach(function(e){var a=t.call(e);"[object Object]"===a||"[object Array]"===a?n.push(O.copy(e)):n.push(e)})}return n},saveAsImage:function(e,t){for(var a=this,n=0,i=[],r=null,s=e.length,o=a.tab.getActive(),l=a.createImageCanvas,c=function(t){var n=t.shift();if(!n)return function(){var t=l.toDataURL(),n=a.tab.getPage(o.id);l.width=l.width;var s={type:"image",data:[t,0,0],width:0,height:0,status:1,origin:!0,from:"auto"};n&&(s.pageNumber=n.getPageNumber()),r&&e.push(r),e.push(s),[].push.apply(e,i),a.tab.saveData.call(a)}();"file"===n.type?(r=n,c(t)):O.render.call(a,n,function(){c(t)},!0)};s--;){var d=e.pop();if(i.unshift(d),d.origin&&n++,a.params.saveImgStep<=n){l.width=l.width,e.length?c(e):[].push.apply(e,i);break}}},trim:function(e){if(e&&"[object String]"==t.call(e))return e.replace(/^\s*|\s*$/,"")},splitPage:function(e){var a={},n=[],i=[];for(var r in e.forEach(function(e){"[object String]"===t.call(e)?i.push(e):(a[e.pageNumber]=a[e.pageNumber]||[],a[e.pageNumber].push(e))}),a)a.hasOwnProperty(r)&&n.push(r);return n.sort(function(e,t){return e-t}),n.forEach(function(e){i.push(a[e])}),i},renderPen:function(e,t,a){var n=this,i=a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas,r=e.data,s=i.width/e.width,o=i.height/e.height,l=i.getContext("2d");0===e.status?i.width=i.width:n.bufferCanvas.width=n.bufferCanvas.width,l.strokeStyle=e.color,l.lineWidth=1,l.save(),l.scale(s,o),r.forEach(function(e,t){0===t?(l.beginPath(),l.moveTo(e.x,e.y)):l.lineTo(e.x,e.y)}),l.stroke(),l.restore(),t&&t()},renderRect:function(e,t,a){var n=this,i=(e.mode,a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas),r=e.data,s=i.width/e.width,o=i.height/e.height,l=i.getContext("2d");0===e.status?i.width=i.width:n.bufferCanvas.width=n.bufferCanvas.width,l.save(),l.scale(s,o),l.beginPath(),0===e.mode?(l.strokeStyle=e.color,l.lineWidth=1,l.strokeRect(r[0],r[1],r[2],r[3])):(l.fillStyle=e.color,l.fillRect(r[0],r[1],r[2],r[3])),l.restore(),t&&t()},renderLine:function(e,t,a){var n=this,i=e.mode,r=a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas,s=e.data,o=r.width/e.width,l=r.height/e.height,c=r.getContext("2d");if(0===e.status?r.width=r.width:n.bufferCanvas.width=n.bufferCanvas.width,c.strokeStyle=e.color,c.lineWidth=1,c.save(),c.scale(o,l),c.beginPath(),c.moveTo(s[0],s[1]),c.lineTo(s[2],s[3]),1===i){var d=180*Math.atan2(s[1]-s[3],s[0]-s[2])/Math.PI,u=(d+30)*Math.PI/180,f=(d-30)*Math.PI/180,h=15*Math.cos(u),p=15*Math.sin(u),m=15*Math.cos(f),v=15*Math.sin(f);c.moveTo(h+s[2],p+s[3]),c.lineTo(s[2],s[3]),c.moveTo(m+s[2],v+s[3]),c.lineTo(s[2],s[3])}c.stroke(),c.restore(),t&&t()},renderRound:function(e,t,a){var n=this,i=e.mode,r=a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas,s=e.data,o=r.width/e.width,l=r.height/e.height,c=r.getContext("2d");switch(0===e.status?r.width=r.width:n.bufferCanvas.width=n.bufferCanvas.width,c.save(),c.scale(o,l),c.beginPath(),i){case 0:c.strokeStyle=e.color,c.lineWidth=1,c.arc(s[0],s[1],s[2],0,2*Math.PI),c.stroke();break;case 1:c.fillStyle=e.color,c.arc(s[0],s[1],s[2],0,2*Math.PI),c.fill();break;case 2:c.strokeStyle=e.color,c.lineWidth=1;var d=s[2]>s[3]?s[2]:s[3],u=s[2]/d,f=s[3]/d;c.scale(u,f),c.arc(s[0]/u,s[1]/f,d,0,2*Math.PI),c.closePath(),c.stroke();break;case 3:c.fillStyle=e.color;d=s[2]>s[3]?s[2]:s[3],u=s[2]/d,f=s[3]/d;c.scale(u,f),c.arc(s[0]/u,s[1]/f,d,0,2*Math.PI),c.closePath(),c.fill()}c.restore(),t&&t()},renderText:function(e,t,a){var n=this,i=a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas,r=e.data,s=i.width/e.width,o=i.height/e.height,l=i.getContext("2d");0===e.status?i.width=i.width:n.bufferCanvas.width=n.bufferCanvas.width,l.fillStyle=e.color,l.font=e.size+"px sans-serif",l.save(),l.scale(s,o),l.beginPath(),l.fillText(r[2],r[0],r[1]),l.restore(),t&&t()},renderImage:function(e,t,a){var n=this,i=a?n.createImageCanvas:0===e.status?n.bufferCanvas:"file"===e.type?n.fileCanvas:n.mainCanvas,r=e.data,s=e.width,o=e.height,l=n.tplImage,c=i.getContext("2d");l.src=r[0],l.onload=function(){var r=l.width,d=l.height;if("file"!==e.type||0==e.status||a||(s=n.params.width,o=n.params.height,n.tab.resizePad(s,o),n.tab.resizePadPixel(s,o)),c.save(),"file"===e.type){var u=r,f=d;o>s/(r/d)?f=d+d*(o/s-d/r)>>0:o=s/(r/d)>>0,n.tab.resizePad(s,o),n.tab.resizePadPixel(u,f),c.drawImage(l,(u-r)/2,(f-d)/2,r,d)}else{var h=i.width,p=i.height,m=r*(h/s),v=d*(p/o),g=h-m,b=p-v;if(g>=0&&b>=0){var w=g/2,y=b/2;c.drawImage(l,w,y,m,v)}else{var C=h/p,x=l.width/l.height;C>x?c.drawImage(l,(h-p*x)/2,0,p*x,p):c.drawImage(l,0,(p-h/x)/2,h,h/x)}}c.restore(),t&&t()}},delete:function(e,t,a){var n=this,i=a?n.createImageCanvas:0===e.status?n.bufferCanvas:n.mainCanvas,r=e.data,s=i.width/e.width,o=i.height/e.height,l=i.getContext("2d");0===e.status?i.width=i.width:n.bufferCanvas.width=n.bufferCanvas.width,r.forEach(function(t){if(0===e.mode){var a=t.size/2*Math.sin(Math.atan((t.y-t.ey)/(t.x-t.ex)))||0,r=t.size/2*Math.cos(Math.atan((t.y-t.ey)/(t.x-t.ex)))||0,c=t.ex+a,d=t.ey-r,u=t.ex-a,f=t.ey+r,h=t.x+a,p=t.y-r,m=t.x-a,v=t.y+r;l.save(),l.scale(s,o),l.beginPath(),l.arc(t.x,t.y,t.size/2,0,2*Math.PI),l.clip(),l.clearRect(0,0,i.width,i.height),l.restore()}else{c=t.ex-t.size/2,d=t.ey-t.size/2,u=t.ex-t.size/2,f=t.ey+t.size/2,h=t.x+t.size/2,p=t.y-t.size/2,m=t.x-t.size/2,v=t.y+t.size/2;l.save(),l.scale(s,o),l.beginPath(),l.rect(c,d,t.size,t.size),l.clip(),l.clearRect(0,0,i.width,i.height),l.restore()}l.save(),l.scale(s,o),l.beginPath(),l.moveTo(c,d),l.lineTo(u,f),l.lineTo(h,p),l.lineTo(m,v),l.closePath(),l.clip(),l.clearRect(0,0,n.params.width,n.params.height),l.restore()}),t&&t()},render:function(e,t,a){var n=this;switch(e.type){case"pen":O.renderPen.call(n,e,t,a);break;case"rectangle":O.renderRect.call(n,e,t,a);break;case"line":O.renderLine.call(n,e,t,a);break;case"round":O.renderRound.call(n,e,t,a);break;case"text":O.renderText.call(n,e,t,a);break;case"image":case"file":O.renderImage.call(n,e,t,a);break;case"eraser":O.delete.call(n,e,t,a)}}},j={eraser:function(e){var t=this.mouseIconCanvas,a=e.data,n=e.mode,i=t.width/e.width,r=t.height/e.height,s=t.getContext("2d");if(t.width=t.width,-1!==a[0]&&-1!==a[1])if(s.scale(i,r),s.beginPath(),0===n)s.arc(a[0],a[1],a[2]/2,0,2*Math.PI),s.stroke();else{var o=a[0]-a[2]/2,l=a[1]-a[2]/2;s.rect(o,l,a[2],a[2]),s.stroke()}},ferula:function(e){var t=this.mouseIconCanvas,a=e.data,n=this.params.ferulaSize,i=t.width/e.width,r=t.height/e.height,s=t.getContext("2d");t.width=t.width,-1!==a[0]&&-1!==a[1]&&(s.scale(i,r),s.beginPath(),s.fillStyle="red",s.arc(a[0],a[1],n,0,2*Math.PI),s.fill())},render:function(e){var t=e.type;j[t]&&j[t].call(this,e)}},N=function(){var e=document.createElement("UL"),a='<li class="pad-tab-item" title="@LABEL@">@LABEL@@DELETEBTN@</li>',n='<i class="iconfont icon-close"></i>';function i(i){var r=this,s={},o={},l={},c={},d=[],f=!1,h={},p=i.getElementsByClassName("pad-tab-list")[0];r.build=function(i,f){if(i){if(!(d.length>=this.params.tabLimit)){var h=this,m=f.type,v=f.data,b=f.from,w=0!==f.type&&(!!h.params.super||b==h.params.id),y=f.id?f.id:0===m?0:O.uuid,C=a.replace(/@LABEL@/g,f.name?f.name:g[m]).replace(/@DELETEBTN@/g,w?n:"");e.innerHTML=C,d.push(y);var x=e.firstElementChild||e.firstChild;return s[y]=x,o[y]=v||[],l[y]=i,w&&E.addEvent(x.getElementsByTagName("i")[0],u.click,function(){var e=[].slice.call(arguments,0)[0]||window.event;window.event?(e.returnValue=!1,e.cancelBubble=!0):(e.preventDefault(),e.stopPropagation()),r.remove.call(h,y),h.params.onTabRemove&&h.params.onTabRemove(y)}),E.addEvent(x,u.click,function(){!0!==h.params.disable&&this!==c.tab&&(r.active.call(h,y),h.params.onTabChange&&h.params.onTabChange(y))}),p.appendChild(x),h.container[y]={data:o[y],type:m,splitPage:0,from:b},r.resizeTab(),f.name&&(h.container[y].tabName=f.name),y}"[object Function]"===t.call(this.params.onError)&&this.params.onError({code:0,message:"白板页签已达上限"})}},r.push=function(e,t){var a=this,n=0;o[e]||(o[e]=[]),o[e].push(t),a.tab.saveData.call(a),o[e].forEach(function(e){"auto"!=e.from&&n++}),n-a.params.saveImgStep>=a.params.saveImgStep&&O.saveAsImage.call(a,o[e],a.container[e].type)},r.saveData=function(){var e=this;if(!f&&"never"!==e.params.autoSaveTime){e.params.autoSaveTime=isNaN(e.params.autoSaveTime)?10:+e.params.autoSaveTime;var t=setTimeout(function(){for(var a in h)if(h.hasOwnProperty(a)){var n=h[a];o[a].length=0,[].push.apply(o[a],n.getData())}!e.params.noCache&&window.localStorage.setItem(e.id+"_pad",JSON.stringify(e.container)),clearTimeout(t),f=!1},1e3*e.params.autoSaveTime);f=!0}},r.resizeTab=function(){var e=p.clientWidth/d.length;e=e>112?112:e,p.style.setProperty("--tab-width",e-12+"px")},r.remove=function(e){var t=this,a=s[e],n=d.indexOf(e);delete s[e],delete o[e],delete l[e],delete t.container[e],delete h[e],p.removeChild(a),d.splice(n,1),c.id==e&&(e=d[Math.max(n-1,0)],t.tab.active.call(t,e)),t.tab.resizeTab(),!t.params.noCache&&window.localStorage.setItem(t.id+"_pad",JSON.stringify(t.container))},r.active=function(e,t,a){if(!s[e])return!1;var n=this,i=o[e];if(E.removeClass(c.tab,"active"),t||(n.tab.resizePad(),n.tab.resizePadPixel()),!a&&n.scroll.toOrigin(),c.page&&(c.page.hide(),delete c.page),n.container[e].type!=c.type&&(E.css(c.canvas||n.mainCanvas,"background"),E.css(l[e],"background",n.params.background)),c.tab=s[e],c.data=o[e],c.canvas=l[e],c.id=e,c.type=n.container[e].type,c.name=n.container[e].tabName||"",c.page=h[e],E.addClass(c.tab,"active"),c.page&&c.page.show(),i&&!c.page){c.canvas.width=c.canvas.width;var r=0,d=i.length;if(d){var u=function(){var e=i[r];e&&O.render.call(n,e,function(){++r<d&&u()})};u()}}return!0},r.getActive=function(){return c},r.getTab=function(e){return s[e]},r.clear=function(e){var a=this;if(void 0===e)c.page?c.page.clear.call(a):(c.data.length=0,c.canvas.width=c.canvas.width,"[object Function]"===t.call(a.params.onClear)&&a.params.onClear({tabId:c.id}));else{var n=e.tabId;h[n]?h[n].clear.call(a,e):(o[n]&&(o[n].length=0),l[n]&&(l[n].width=l[n].width))}!a.params.noCache&&window.localStorage.setItem(a.id+"_pad",JSON.stringify(a.container))},r.cleanCache=function(){!this.params.noCache&&window.localStorage.removeItem(this.id+"_pad")},r.setPage=function(e,t){h[e]=t,this.container[e].splitPage=1},r.getPage=function(e){return h[e]},r.render=function(e,a){O.render.call(this,e,function(){if("[object Function]"===t.call(a)){var n=O.copy(e),i={};i[c.id]={data:n,type:c.type,splitPage:c.page?1:0},a(i)}}),e.status&&this.tab.push.call(this,c.id,e)}}return i.prototype={constructor:i},i}();function I(e){if(!this instanceof I)return new I(e);var a=this,n=1,i=e.that,r=O.splitPage(e.data),s=r.length,o=e.tabId,l=e.show||!1,c=document.createElement("DIV"),d=i.params.wrap.getElementsByClassName("split-page-wrap")[0];c.innerHTML=C.replace(/@TOTAL@/g,s);var f=c.removeChild(c.firstElementChild||c.firstChild),h=f.getElementsByClassName("pre-page-btn")[0],p=f.getElementsByClassName("next-page-btn")[0],m=f.getElementsByClassName("go-page-btn")[0],v=f.getElementsByClassName("page-number-input")[0];E.addEvent(h,u.click,function(){i.params.disable||n<=1||a.pre()}),E.addEvent(p,u.click,function(){i.params.disable||n>=s||a.next()}),E.addEvent(m,u.click,function(){if(!i.params.disable){var e=v.value;a.go(e,function(){e=v.value,i.params.onPageTurn&&i.params.onPageTurn(o,e,r[e-1][0])})}}),E.addEvent(v,"input",function(){/^\s*([0-9]+).*\s*$/.test(this.value)?this.value=RegExp.$1:this.value=n}),E.addEvent(v,"keypress",function(){var e=[].slice.call(arguments,0),t=window.event||e[0];if(13===t.keyCode||13===t.which){var n=v.value;a.go(n,function(){n=v.value,i.params.onPageTurn&&i.params.onPageTurn(o,n,r[n-1][0])})}}),this.pre=function(){n--,this.go(n,function(){i.params.onPageTurn&&i.params.onPageTurn(o,n,r[n-1][0])})};var g=function(e,a,n){var s=r[e-1];"[object Array]"===t.call(s)?s.some(function(t,r){if(!(r<a)){var o=!1;return"file"===t.type?(o=!0,O.render.call(i,t,function(){s.length-1<=r?n&&n():g(e,++r,n)})):(O.render.call(i,t),s.length-1<=r&&n&&n()),o}}):O.render.call(i,s,n)};this.go=function(e,a){switch(g(e=(e=e<=1?1:e)>=s?s:e,0,function(){"[object Function]"===t.call(a)&&a()}),n=e,v.value=e,!0){case n<=1&&n<s:E.addClass(h,"no"),E.removeClass(p,"no");break;case n>1&&n>=s:E.removeClass(h,"no"),E.addClass(p,"no");break;default:E.removeClass(h,"no"),E.removeClass(p,"no")}},this.next=function(){n++,this.go(n,function(){i.params.onPageTurn&&i.params.onPageTurn(o,n,r[n-1][0])})},this.show=function(){if(d.innerHTML="",r.length>1)switch(d.appendChild(f),i.params.splitpageLayout){case"left":d.style.left="10px";break;case"center":d.style.left=(d.parentNode.clientWidth-d.offsetWidth)/2+"px";break;default:d.style.right="10px"}this.go(n)},this.hide=function(){i.tab.getActive().page==a&&r.length>1&&d.removeChild(f)},this.getPageNumber=function(){return n},this.empower=function(){v.removeAttribute("readonly")},this.disable=function(){v.setAttribute("readonly","readonly")},r.forEach(function(a,n){"[object String]"===t.call(a)&&(r[n]=[{data:[a,0,0],pageNumber:n+1,width:i.mainCanvas.offsetWidth,height:i.mainCanvas.offsetHeight,status:1,type:"file",from:e.from}])}),this.push=function(e,t){var a=i.tab.getActive(),s=0;e.pageNumber=void 0!=t?t:n,r[e.pageNumber-1].push(e),i.tab.saveData.call(i),r[e.pageNumber-1].forEach(function(e){"file"!=e.type&&"auto"!=e.from&&s++}),s-i.params.saveImgStep>=i.params.saveImgStep&&O.saveAsImage.call(i,r[e.pageNumber-1],i.container[a.id].type)},this.getData=function(){for(var e=0,t=[];e<s;)[].push.apply(t,r[e]),e++;return t},this.clear=function(e){var a=(e?e.pageNumber:n)||n;r[a-1].length=1,i.tab.saveData.call(i),(void 0===e||e.tabId==i.tab.getActive().id&&e.pageNumber==n)&&(i.mainCanvas.width=i.mainCanvas.width,void 0===e&&"[object Function]"===t.call(i.params.onClear)&&i.params.onClear({tabId:i.tab.getActive().id,pageNumber:a}))},this.render=function(e,a){var i=this;O.render.call(i,e,function(){if("[object Function]"===t.call(a)){var r=O.copy(e),s={},o=i.tab.getActive();s[o.id]={data:r,type:o.type,pageNumber:n,splitPage:o.page?1:0},a(s)}}),e.status&&i.tab.getActive().page.push.call(i,e)},i.params.disable&&this.disable(),i.tab.saveData.call(i),l&&this.show()}function S(n){if(!this instanceof S)return new S(n);var i=new Image;i.setAttribute("crossOrigin","anonymous");var s={pad:this,params:n,waitList:[],container:{},tplImage:i,id:n.id||r++,render:function(e){var a=s.tab.getActive();a.page?a.page.render.call(s,e,function(e){"[object Function]"===t.call(n.onRender)&&n.onRender(e)}):s.tab.render.call(s,e,function(e){"[object Function]"===t.call(n.onRender)&&n.onRender(e)})},mouseRender:function(e){if(j.render.call(s,e),n.onMousemove){var t=O.copy(e),a={},i=s.tab.getActive();a[i.id]={data:t,type:i.type},n.onMousemove(a)}}};(function(){var n=this,i=this.params,r=i.wrap,s=i.toolbars,l={},c=!1,d=null,h=null,g=null,C=new FileReader,j=!1,S="",B=!1,P=r.requestFullscreen||r.webkitRequestFullscreen||r.mozRequestFullScreen||r.msRequestFullscreen,A=document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen,k=null,L=null,R=null,M=null,z=null,H=null,W=null,D=null;s.forEach(function(t){var a=p[t];switch(t){case"handPad":case"color":case"clear":case"export":break;default:a?a.forEach(function(a){l[a]=new e.module[t]({name:a})}):l[t]=new e.module[t]({name:t})}var n=w.replace(/@ITEM@/g,a?a[0]:t).replace(/@ICONCLASS@/g,a?v[a[0]]:v[t]).replace(/@TITLE@/g,a?m[a[0]]:m[t]).replace(/@LEVEL@/g,0);if(n=n.replace(/@CHILDTOOLBARS@/g,a?y:""),a){var i="";a.forEach(function(e){i+=w.replace(/@ITEM@/g,e).replace(/@ICONCLASS@/g,v[e]).replace(/@TITLE@/g,m[e]).replace(/@CHILDTOOLBARS@/g,"").replace(/@LEVEL@/g,1)}),n=n.replace(/@CHILDTOOLBARITEM@/g,i)}S+=n}),0!=i.fullScreen&&(S+=x);var F=b.replace(/@LAYOUT@/g,f[i.layout]+(i.vertical?" vertical":"")).replace(/@TOOLBARS@/g,S).replace(/@DISABLED@/g,i.disable?"disabled":"").replace(/@NOTOOLBAR@/g,i.noToolbar?"no-toolbar":"").replace(/@NOTAB@/g,i.noTab?"no-tab":""),$=i.data||(i.noCache?null:JSON.parse(window.localStorage.getItem(n.id+"_pad")));r.innerHTML=F,this.toolbarMap=l;var q=r.getElementsByClassName("can-wrap")[0],U=r.getElementsByClassName("toolbar-list")[0],Y=U.getElementsByClassName("full-screen-btn")[0];k=r.getElementsByClassName("color-input")[0],L=r.getElementsByClassName("file-input")[0],R=r.getElementsByClassName("text-input")[0],M=r.getElementsByClassName("main-can")[0],z=r.getElementsByClassName("buffer-can-1")[0],H=r.getElementsByClassName("buffer-can-2")[0],W=r.getElementsByClassName("buffer-can-3")[0],D=r.getElementsByClassName("buffer-can-4")[0];E.redefineEvent("mousemove","mouserun",z);var V=function(){var e=q.clientWidth,t=q.clientHeight;switch(!0){case/^\s*(\d+)\s*\*\s*(\d+)\s*$/.test(i.size):e=+RegExp.$1,t=+RegExp.$2;break;case/^\s*(\d+)\s*:\s*(\d+)\s*$/.test(i.size):var a=q.clientWidth,n=q.clientHeight;switch(!0){case RegExp.$1/RegExp.$2>a/n:e=a,t=a/RegExp.$1*RegExp.$2;break;case RegExp.$1/RegExp.$2<a/n:t=n,e=n/RegExp.$2*RegExp.$1;break;default:e=a,t=n}break;case/^\s*(\d+)%\s*$/.test(i.size):var a=q.clientWidth,n=q.clientHeight;e=a/100*RegExp.$1,t=n/100*RegExp.$1;break;default:e=q.clientWidth,t=q.clientHeight}i.width=e>>0,i.height=t>>0};E.addEvent(q,u.wheel,function(){var e=[].slice.call(arguments,0),t=e[0]||window.event;if(window.event?(t.returnValue=!1,t.cancelBubble=!0):(t.preventDefault(),t.stopPropagation()),1!=G.disable&&G.scrollObj.y.coverHeight>0){var a={type:"y",from:i.id,coverHeight:G.scrollObj.y.coverHeight,distance:G.scrollObj.y.top+("DOMMouseScroll"===t.type?3===t.detail?100:-100:t.deltaY)/5};G.scroll(a)}});var X=q.clientWidth,_=q.clientHeight;E.redefineEvent("resize","sizeChange",window),E.addEvent(window,"sizeChange",function(){var e=q.clientWidth,t=q.clientHeight;e==X&&t==_||(V(),n.tab.active.call(n,n.tab.getActive().id,null,!0),X=e,_=t),n.tab.resizeTab()});var J=function(e,t){var a=e||i.width,n=t||i.height;if(M.style.width=z.style.width=H.style.width=W.style.width=D.style.width=a+"px",M.style.height=z.style.height=H.style.height=W.style.height=D.style.height=n+"px",M.style.left=z.style.left=H.style.left=W.style.left=D.style.left=0,M.style.top=z.style.top=H.style.top=W.style.top=D.style.top=0,a<q.clientWidth){var r=(q.clientWidth-a)/2;M.style.left=z.style.left=H.style.left=W.style.left=D.style.left=r+"px"}if(n<q.clientHeight){var s=(q.clientHeight-n)/2;M.style.top=z.style.top=H.style.top=W.style.top=D.style.top=s+"px"}G&&G.resize()},K=function(e,t){var a=e||i.width,n=t||i.height;M.width=z.width=H.width=W.width=D.width=a,M.height=z.height=H.height=W.height=D.height=n};n.tab=new N(i.wrap),n.textInput=R,n.mouseIconCanvas=z,n.createImageCanvas=W,n.fileCanvas=D,n.mainCanvas=M,V();var G=T.init({node:q,id:i.id});G.disable=i.disable,n.scroll=G,G.addEvent("scroll",function(e){"[object Function]"===t.call(i.onScroll)&&i.onScroll(e)}),Object.defineProperty(n.tab,"resizePad",{value:J}),Object.defineProperty(n.tab,"resizePadPixel",{value:K}),E.addEvent(k,"change",function(){n.params.color=this.value}),E.addEvent(r.getElementsByClassName("pad-wrap")[0],u.fullScreen,function(){B=!B,E.removeClass(Y,B?"icon-enlarge":"icon-narrow"),E.addClass(Y,B?"icon-narrow":"icon-enlarge")});var Q=function(e){o?(e?E.addClass(r,"pad-full-screen"):E.removeClass(r,"pad-full-screen"),B=e,E.removeClass(Y,B?"icon-enlarge":"icon-narrow"),E.addClass(Y,B?"icon-narrow":"icon-enlarge"),n.tab.active.call(n,n.tab.getActive().id)):e?P.call(r.getElementsByClassName("pad-wrap")[0]):A.call(document)};n.pad.resize=function(e,t){isNaN(e)||isNaN(t)?(V(),n.tab.active.call(n,n.tab.getActive().id)):(J(e,t),K(e,t),n.tab.active.call(n,n.tab.getActive().id,!0))},n.pad.scroll=function(e){G.scroll(e)},n.pad.fullScreen=function(){B||Q(!0)},n.pad.exitFullScreen=function(){B&&Q(!1)},n.pad.showFiles=function(e){var a=e.files,i=e.newTab,r=e.isShow,s=void 0!=e.from?e.from:n.params.id,o=e.tabId,l=e.tabName,c=n.tab.getActive();a="[object Array]"===t.call(a)?a:[a];var d=function(){var o=new I({data:a,show:r,that:n,width:e.width,height:e.height,from:s,tabId:i?u:c.id});n.tab.setPage.call(n,void 0!=u?u:c.id,o),c.page=o,n.params.id==s&&"[object Function]"===t.call(n.params.onShowFiles)&&(e.from=s,n.params.onShowFiles(e))};if(i){var u=n.tab.build.call(n,D,{type:1,id:o,name:l,from:s});e.tabId=u,r&&(n.tab.active.call(n,u),d(),s==n.params.id&&n.params.onTabChange&&n.params.onTabChange(u))}else 0==n.tab.getActive().id?(n.toolbarMap.image.renderBuffer.call(n,e.files),n.toolbarMap.image.render.call(n,[0,0])):(n.pad.clear(),d())},C.onload=function(e){n.toolbarMap.image.renderBuffer.call(n,e.target.result),n.toolbarMap.image.render.call(n,[0,0]),L.value=""},E.addEvent(L,"change",function(){C.readAsDataURL(this.files[0])}),E.addEvent(R,"input",function(){this.style.width=this.scrollWidth+"px"}),E.addEvent(R,"keyup",function(){var e=[].slice.call(arguments,0),t=e[0]||window.event;if(13===t.which){var a=O.trim(this.value);d.render.call(n,a)}}),E.addEvent(document,"keydown",function(){var e=[].slice.call(arguments,0),t=e[0]||window.event,a=t.which;if(n.active)switch(!0){case 107===a||187===a&&t.shiftKey:d&&d.largen&&d.largen.call(n);break;case 109===a||189===a&&t.shiftKey:d&&d.lesser&&d.lesser.call(n)}}),E.addEvent(U,u.click,function(){if(!i.disable){var e=[].slice.call(arguments,0),t=e[0]||window.event,r=t.srcElement||t.target,s=+r.getAttribute("level"),o=r.getAttribute("item");if(o){switch(d&&d.destory.call(n),o){case"handPad":(c=!c)?r.setAttribute("active",""):r.removeAttribute("active");break;case"color":k.click();break;case"clear":n.tab.clear.call(n);break;case"export":!function(){var e=n.tab.getActive().name||O.uuid,t=document.createElement("A"),i=n.createImageCanvas,r=i.getContext("2d"),s=n.params.wrap.getElementsByClassName("pad-wrap")[0];r.drawImage(n.fileCanvas,0,0),r.drawImage(n.mainCanvas,0,0);var o=i.toDataURL().split(","),l=atob(o[1]),c=l.length,d=new Uint8ClampedArray(c);for(;c--;)d[c]=l.charCodeAt(c);var u=a.createObjectURL(new Blob([d],{mime:"image/octet-stream;Content-Disposition:attachment"}));t.className="export-image",t.href=u,t.download=e+".png",s.appendChild(t),t.click();var f=setTimeout(function(){f&&clearTimeout(f),a.revokeObjectURL(u)},300);i.width=i.width,s.removeChild(t)}();break;case"image":L.click();break;case"fullScreen":Q(!B);break;default:if(!(d=l[o]||d))return;if(n.current=d,d.active(),0===s){h&&h.removeAttribute("active"),h=r;var u=U.getElementsByClassName("selected-item")[0];r.parentNode!=u&&E.removeClass(u,"selected-item"),E.addClass(r.parentNode,"selected-item")}if(1===s){g&&g.removeAttribute("active");var f=E.preNode(r.parentNode.parentNode);f.title=r.parentNode.title,f.className=f.className.replace(/\bicon-[\w-]+\b/,r.className.match(/\bicon-[\w-]+\b/)),f.setAttribute("item",o),g=r}r.setAttribute("active","")}o&&(window.event?(t.returnValue=!1,t.cancelBubble=!0):(t.preventDefault(),t.stopPropagation()))}}}),E.addEvent(U,"mousedown",function(){var e=[].slice.call(arguments,0),t=e[0]||window.event;window.event?(t.returnValue=!1,t.cancelBubble=!0):(t.preventDefault(),t.stopPropagation())});var Z=0,ee=0;if(E.addEvent(z,u.move,function(){var e=[].slice.call(arguments,0)[0]||window.event;if(e=o?e:e.detail?e.detail:e,!(o&&e.targetTouches.length>1)){var t=this.getBoundingClientRect(),a=o?e.targetTouches[0].clientX:e.clientX,r=o?e.targetTouches[0].clientY:e.clientY,s={x:a-(t.x||t.left),y:r-(t.y||t.top)};if(d){var l=d.name.toLowerCase();if(c||j)switch(l){case"ferula":d.mouseRender.call(n,s);break;case"circular":case"quadrate":d.mouseRender.call(n,s);default:d.bufferRender.call(n,s)}else d.mouseRender&&d.mouseRender.call(n,s)}else if(j){if(!0===G.disable)return;var u=Z-a,f=ee-r;o&&(u/=10,f/=10),G.scrollObj.x.coverWidth>0&&(G.scroll({type:"x",from:i.id,distance:G.scrollObj.x.left+u,coverWidth:G.scrollObj.x.coverWidth}),Z=a),G.scrollObj.y.coverHeight>0&&(G.scroll({type:"y",from:i.id,distance:G.scrollObj.y.top+f,coverHeight:G.scrollObj.y.coverHeight}),ee=r)}}}),E.addEvent(z,u.down,function(){var e=[].slice.call(arguments,0)[0]||window.event,t=this.getBoundingClientRect(),a=U.getElementsByClassName("selected-item")[0],i={x:(o?e.targetTouches[0].clientX:e.clientX)-(t.x||t.left),y:(o?e.targetTouches[0].clientY:e.clientY)-(t.y||t.top)};window.event?(e.returnValue=!1,e.cancelBubble=!0):(e.preventDefault(),e.stopPropagation()),Z=o?e.targetTouches[0].clientX:e.clientX,ee=o?e.targetTouches[0].clientY:e.clientY,j=!0,d&&(E.removeClass(a,"selected-item"),d.bufferRender&&d.bufferRender.call(n,i,!0))}),E.addEvent(document,u.down,function(){var e=U.getElementsByClassName("selected-item")[0];E.removeClass(e,"selected-item"),d&&d.destory.call(n)}),E.addEvent(document,"mouseup",function(){j&&(j=!1,d&&d.render&&d.render.call(n))}),E.addEvent(z,u.up,function(){[].slice.call(arguments,0)[0]||window.event,j=!1,d&&d.render&&d.render.call(n)}),E.addEvent(q,"mouseleave",function(){d&&d.destory.call(n)}),n.bufferCanvas=H,$)Object.keys($).sort(function(e,t){return e-t}).forEach(function(e){var t=$[e],a=n.tab.build.call(n,0===t.type?M:D,{type:t.type,data:t.data,id:e,name:t.tabName,from:t.from});if(t.splitPage){var i=new I({data:t.data,show:0===t.type,that:n,tabId:a});n.tab.setPage.call(n,a,i)}0===t.type&&n.tab.active.call(n,a)});else{var te=n.tab.build.call(n,M,{type:0});n.tab.active.call(n,te)}}).call(s);var l=function(e){var t=s.tab.getActive();for(var a in e)if(e.hasOwnProperty(a)){var n=e[a],i=(n.type,n.data);if(a==t.id)t.page?t.page.getPageNumber()==n.pageNumber?t.page.render.call(s,i):i.status&&t.page.push.call(s,i,+n.pageNumber):s.tab.render.call(s,i);else if(s.tab.getTab(a)){if(i.status){var r=s.tab.getPage(a);r?r.push.call(s,i,+n.pageNumber):s.tab.push.call(s,a,i)}}else s.tab.build.call(s,s.fileCanvas,{type:1,data:[i],id:a,from:i.from})}};this.render=function(e){"[object Object]"==t.call(e)?l(e):console.error("TypeError: data must be Object")},this.renderAll=function(e){"[object Object]"==t.call(e)?e.forEach(function(e){l(e)}):console.error("TypeError: data must be Array")},this.mouseCtrl=function(e){"[object Object]"==t.call(e)?function(e){for(var t in e)if(e.hasOwnProperty(t)){(a=e[t]).type;var a=a.data;j.render.call(s,a)}}(e):console.error("TypeError: data must be Object")},this.clear=function(e){s.tab.clear.call(s,e)},this.disable=function(){E.addClass(n.wrap.firstElementChild||n.wrap.firstChild,"disabled"),n.disable=!0},this.enable=function(){E.removeClass(n.wrap.firstElementChild||n.wrap.firstChild,"disabled"),n.disable=!1},this.createImage=function(){return s.mainCanvas.toDataURL()},this.getData=function(e){return s.container[e]||s.container},this.changeTab=function(e){return s.tab.active.call(s,e)},this.turnPage=function(e,t){e==s.tab.getActive().id&&s.tab.getPage.call(s,e).go(t)},this.removeTab=function(e){void 0!=e&&s.tab.remove.call(s,e)},E.addEvent(n.wrap,"mouseenter",function(){s.active=!0}),E.addEvent(n.wrap,"mouseleave",function(){s.active=!1})}I.prototype={constructor:I},window.wPad={init:function(e){var t=O.copy({},h);(t=O.copy(t,e)).id=void 0==t.id?O.uuid:t.id;var a=new S(t);return void 0!=t.id&&(i[t.id]=a),s.push(a),a},getPadById:function(e){if(void 0!==e)return i[e]},getPadByIndex:function(e){if(void 0!==e)return s[e]}}}()},{}],5:[function(e,t,a){!function(){"use strict";var e={line:0,arrow:1};function t(e){this.name=e.name||"Line",this.interimBuffer=[],this.points=[],this.buffer=[]}t.prototype={constructor:t,active:function(){},bufferRender:function(t,a){var n=this;a?(n.current.points=[],n.current.points.push(t.x),n.current.points.push(t.y)):(n.current.points[2]=t.x,n.current.points[3]=t.y),a||(n.current.interimBuffer.pop(),t={type:"line",data:t=[].concat.apply([],n.current.points),status:0,mode:e[n.current.name],origin:!0,color:n.params.color,from:n.params.id,width:n.mainCanvas.offsetWidth,height:n.mainCanvas.offsetHeight},n.current.interimBuffer.push(t),n.render(t))},render:function(){var e=this.current.interimBuffer.shift();if(e)do{e.status=1,this.current.buffer.push(e),this.render(e),e=this.current.interimBuffer.shift()}while(e)},destory:function(){}};var a=window.vm||{};a.module=a.module||{},a.module.line=t,window.vm=a}()},{}],6:[function(e,t,a){!function(){"use strict";function e(e){this.name=e.name||"Pen",this.interimBuffer=[],this.buffer=[]}e.prototype={constructor:e,active:function(){},bufferRender:function(e,t){var a=this,n=t?{type:"pen",data:[],status:0,origin:!!t,color:a.params.color,from:a.params.id,width:a.mainCanvas.offsetWidth,height:a.mainCanvas.offsetHeight}:a.current.interimBuffer.pop();n.data.push(e),a.current.interimBuffer.push(n),a.render(n)},render:function(){var e=this.current.interimBuffer.shift();if(e)do{e.status=1,this.current.buffer.push(e),this.render(e),e=this.current.interimBuffer.shift()}while(e)},destory:function(){}};var t=window.vm||{};t.module=t.module||{},t.module.pen=e,window.vm=t}()},{}],7:[function(e,t,a){!function(){"use strict";var e={rectstroke:0,rect:1};function t(e){this.name=e.name||"Rectangle",this.interimBuffer=[],this.points=[],this.buffer=[]}t.prototype={constructor:t,active:function(){},bufferRender:function(t,a){var n=this;a?(n.current.points=[],n.current.points.push(t.x),n.current.points.push(t.y)):(n.current.points[2]=t.x-(n.current.points[0]||0),n.current.points[3]=t.y-(n.current.points[1]||0),n.current.interimBuffer.pop(),t={type:"rectangle",data:t=[].concat.apply([],n.current.points),status:0,mode:e[n.current.name],origin:!0,color:n.params.color,from:n.params.id,width:n.mainCanvas.offsetWidth,height:n.mainCanvas.offsetHeight},n.current.interimBuffer.push(t),n.render(t))},render:function(){var e=this.current.interimBuffer.shift();if(e)do{e.status=1,this.current.buffer.push(e),this.render(e),e=this.current.interimBuffer.shift()}while(e)},destory:function(){}};var a=window.vm||{};a.module=a.module||{},a.module.rectangle=t,window.vm=a}()},{}],8:[function(e,t,a){!function(){"use strict";var e={circle:0,roundel:1,ellipesstroke:2,ellipes:3};function t(e){this.name=e.name||"Round",this.interimBuffer=[],this.points=[],this.buffer=[]}t.prototype={constructor:t,active:function(){},bufferRender:function(t,a){var n=this;if(a)n.current.points=[],n.current.points.push(t.x),n.current.points.push(t.y);else{var i=[],r=n.current.points[0],s=n.current.points[1],o=e[n.current.name],l=t.x-r,c=t.y-s;i.push((r+t.x)/2),i.push((s+t.y)/2),0===o||1===o?i.push(Math.abs(l)>Math.abs(c)?Math.abs(l)/2:Math.abs(c)/2):(i.push(Math.abs(l)/2),i.push(Math.abs(c)/2)),n.current.interimBuffer.pop(),t={type:"round",data:i,status:0,mode:o,origin:!0,color:n.params.color,from:n.params.id,width:n.mainCanvas.offsetWidth,height:n.mainCanvas.offsetHeight},n.current.interimBuffer.push(t),n.render(t)}},render:function(){var e=this.current.interimBuffer.shift();if(e)do{e.status=1,this.current.buffer.push(e),this.render(e),e=this.current.interimBuffer.shift()}while(e)},destory:function(){}};var a=window.vm||{};a.module=a.module||{},a.module.round=t,window.vm=a}()},{}],9:[function(e,t,a){!function(){"use strict";function e(e){this.name=e.name||"Text",this.interimBuffer=[],this.points=[],this.buffer=[]}e.prototype={constructor:e,active:function(){},bufferRender:function(e,t){var a=this;t&&(a.current.points=[],a.current.points.push(e.x),a.current.points.push(e.y),a.textInput.style.cssText="visibility: visible; z-index: 101; font-size: "+a.params.fontSize+"; left: "+(e.x+a.mainCanvas.offsetLeft)+"px; top: "+(e.y+a.mainCanvas.offsetTop-a.textInput.offsetHeight/2-18)+"px",a.textInput.focus(),e={type:"text",data:[e.x,e.y],status:0,origin:!!t,color:a.params.color,size:a.params.fontSize,from:a.params.id,width:a.mainCanvas.offsetWidth,height:a.mainCanvas.offsetHeight},a.current.interimBuffer.push(e))},render:function(e){if("[object String]"==Object.prototype.toString.call(e)&&(e=e.replace(/^\s*|\s*$/,""))){var t=this,a=t.current.interimBuffer.pop();a&&(a.data.push(e),t.textInput.value="",t.textInput.removeAttribute("style"),a.status=1,t.current.buffer.push(a),t.render(a),t.current.interimBuffer.length=0)}},destory:function(){var e=this,t=e.textInput.value.replace(/^\s*|\s*$/,"");t&&e.current.render.call(e,t),e.textInput.value="",e.textInput.removeAttribute("style")}};var t=window.vm||{};t.module=t.module||{},t.module.text=e,window.vm=t}()},{}]},{},[1,2,3,5,6,7,8,9,4]);
//# sourceMappingURL=index.min.js.map
